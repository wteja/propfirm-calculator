# PropFirm Risk Calculator

A production-ready, offline-capable Risk Per Trade Calculator for proprietary trading accounts. Built with React + TypeScript + Vite, deployed as a PWA.

## Features

- **Risk Calculator** — Computes safe position size, expectancy, R:R, risk of ruin, and time-to-target estimates
- **Monte Carlo Simulation** — 1,000 randomized equity curve simulations with success rate probability
- **Losing Streak Simulator** — Visualizes drawdown impact of consecutive losses
- **Multi-Account Comparison** — Side-by-side comparison of multiple prop firm setups
- **Export / Import** — JSON config export/import + PDF report generation
- **PWA** — Works offline, installable on mobile (Add to Home Screen)
- **Local Storage** — Auto-saves last configuration on every change

## Tech Stack

- React 18 + TypeScript
- Vite 5
- Tailwind CSS 3
- Recharts
- jsPDF (lazy-loaded for PDF export)
- vite-plugin-pwa (Workbox)

---

## Getting Started

### Prerequisites

- Node.js 18+ and npm

### Install Dependencies

```bash
npm install
```

### Generate PWA Icons

```bash
node scripts/generate-icons.mjs
```

This creates `public/icons/icon-192.png` and `public/icons/icon-512.png` using pure Node.js.

### Development Server

```bash
npm run dev
```

Open [http://localhost:5173/propfirm-calculator/](http://localhost:5173/propfirm-calculator/)

### Production Build

```bash
npm run build
```

Output is in the `dist/` directory.

### Preview Build Locally

```bash
npm run preview
```

---

## Deploy to GitHub Pages

### Step 1 — Create a GitHub Repository

Create a new public repository on GitHub, e.g. `propfirm-calculator`.

### Step 2 — Update Base URL

In [vite.config.ts](vite.config.ts), update `BASE_URL` to match your repo name:

```ts
const BASE_URL = '/your-repo-name/';
```

### Step 3 — Initialize Git and Push

```bash
git init
git add .
git commit -m "Initial commit"
git branch -M main
git remote add origin https://github.com/YOUR_USERNAME/propfirm-calculator.git
git push -u origin main
```

### Step 4 — Deploy

```bash
npm run deploy
```

This runs:
1. `npm run build` — TypeScript compile + Vite build
2. `gh-pages -d dist` — Pushes `dist/` to the `gh-pages` branch

### Step 5 — Enable GitHub Pages

1. Go to your repo on GitHub
2. **Settings → Pages**
3. Source: **Deploy from a branch**
4. Branch: **gh-pages** / `/ (root)`
5. Save

Your app will be live at: `https://YOUR_USERNAME.github.io/propfirm-calculator/`

### Subsequent Deploys

```bash
npm run deploy
```

---

## PWA Setup

The app is fully PWA-enabled via `vite-plugin-pwa`:

- **Service Worker** — Auto-generated by Workbox, caches all static assets
- **Manifest** — Configured in `vite.config.ts`
- **Offline Support** — All assets are pre-cached; works without internet
- **Installable** — "Add to Home Screen" prompt on mobile browsers

To install on mobile:
1. Open the app URL in Chrome/Safari on your phone
2. Tap the browser menu → "Add to Home Screen"
3. The app installs as a standalone PWA

---

## Project Structure

```
propfirm-calculator/
├── public/
│   └── icons/
│       ├── icon.svg          # SVG source icon
│       ├── icon-192.png      # Generated by generate-icons.mjs
│       └── icon-512.png      # Generated by generate-icons.mjs
├── scripts/
│   └── generate-icons.mjs   # Node.js PNG icon generator
├── src/
│   ├── components/
│   │   ├── AccountForm.tsx          # Input form with all config fields
│   │   ├── ExportPanel.tsx          # Floating export/import panel
│   │   ├── Header.tsx               # App header
│   │   ├── InputField.tsx           # Reusable form field components
│   │   ├── LosingStreakSimulator.tsx # Streak impact calculator
│   │   ├── MonteCarloChart.tsx      # MC simulation + equity curves
│   │   ├── MultiAccountComparison.tsx # Multi-account side-by-side
│   │   ├── ResultsPanel.tsx         # Calculated metrics display
│   │   └── RiskWarnings.tsx         # Warning banners
│   ├── hooks/
│   │   └── useLocalStorage.ts       # Persistent state hook
│   ├── types/
│   │   └── index.ts                 # TypeScript interfaces
│   ├── utils/
│   │   ├── calculations.ts          # Core risk math
│   │   ├── monteCarlo.ts            # Monte Carlo engine
│   │   ├── pdf.ts                   # jsPDF export (lazy-loaded)
│   │   └── uuid.ts                  # Lightweight UUID v4
│   ├── App.tsx                      # Root component with tab routing
│   ├── index.css                    # Tailwind + global styles
│   └── main.tsx                     # Entry point
├── .gitignore
├── index.html
├── package.json
├── postcss.config.js
├── tailwind.config.js
├── tsconfig.json
├── tsconfig.node.json
└── vite.config.ts
```

---

## Calculation Reference

| Metric | Formula |
|--------|---------|
| Daily DD ($) | `Balance × DailyDD%` |
| Max DD ($) | `Balance × MaxDD%` |
| Profit Target ($) | `Balance × Target%` |
| Max Daily Profit | `Target$ × Consistency%` |
| Base Risk | `min(MaxDD/5, DailyDD/3, MaxDD/8)` |
| Adjusted Risk | `BaseRisk × mode factor` |
| Reward/Trade | `Risk × R:R` |
| Expectancy (EV) | `(WR × Reward) − (LR × Risk)` |
| Est. Trades | `Target$ / EV` |
| Est. Days | `Trades / TradesPerDay` |
| Risk of Ruin | Gambler's ruin approximation |

### Mode Multipliers

| Mode | Multiplier |
|------|-----------|
| Conservative | ÷ 1.5 |
| Normal | × 1.0 |
| Aggressive | × 1.2 |

---

## Risk Warnings

The app automatically flags:

- **Negative expectancy** (EV ≤ 0)
- **5 consecutive losses → MaxDD breach**
- **Risk % > 1% with MaxDD < 8%**
- **Risk of Ruin > 25%**
- **Aggressive mode active**
- **Tight consistency rule reminders**

---

## License

MIT — for educational and personal use. Not financial advice.
